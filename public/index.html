<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tablas de Verdad</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="stylesheet.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</head>
<body>
  
  <main>
    <div class="container py-4">
      <div id="app">
        <h1>Generador de Tablas de Verdad</h1>
        
        <div class="row">
          <div class="col-6">
            <div class="mb-3">
              <label for="expression" class="form-label">Expresión booleana</label>
              <input class="form-control" id="expression" v-model="expression" @input="processExpression" placeholder="Ingresa una expresión booleana"/>
            </div>
          </div>
          <div class="col-6">
            <div v-if="variables.length > 0">
              <h3>Variables Identificadas</h3>
              <ul>
                <li v-for="variable in variables" :key="variable">{{ variable }}</li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-12">
            <h3>Desarrollo de la tabla</h3>
            <table class="table table-bordered table-hover table-striped truth-table">
              <thead>
                <tr>
                    <th v-for="(col, index) in truthTable[0]" :key="index" :class="{ 'highlight-cell': index == variables.length }">{{ String.fromCharCode(index + 65) }}</th>
                </tr>
                <tr>
                  <th v-for="(header, index) in headers" :key="header" :class="{ 'highlight-cell': index == variables.length }">{{ header.replaceAll("(","").replaceAll(")", "") }}</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="row in truthTable" :key="row">
                  <td v-for="(value, index) in row" :key="value" :class="{ 'highlight-cell': index == variables.length }">
                    {{ value ? "V" : "F" }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <p>Hecho con ❤️ por <a href="https://www.sipofcode.com">Lucas</a></p>
    </main>
    
    
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script>
      class TreeNode {
        constructor(value) {
          this.value = value;
          this.left = null;
          this.right = null;
        }
        print() {
          let ret = "(";
          if (this.left) {
            ret += this.left.print();
          }
          ret += this.value;
          if (this.right) {
            ret += this.right.print();
          }
          return ret + ")";
        }
      }
      
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      new Vue({
        el: '#app',
        data: {
          expression: getQueryParam('e') || '!(correoRecibido || mensajeNoLeido) && notificacionesActivadas',
          variables: [],
          truthTable: [],
          expressionTree: null,
          headers: [],
        },
        computed: {
          postOrderExpressions() {
            return this.postOrder(this.expressionTree);
          }
        },
        methods: {
          processExpression() {
            // Identificar las variables
            this.variables = [...new Set(this.expression.match(/[a-zA-Z]+/g))] || [];
            const tokens = this.expression.match(/([a-zA-Z_]\w*|&&|\|\||!|\(|\)|==)/g) || [];
            this.expressionTree = this.buildExpressionTree(this.shuntingYard(tokens));
            this.truthTable = this.generateTruthTable();
            this.headers = this.generateHeaders();
          },
          generateTruthTable() {
            const variables = this.variables;
            const rows = Math.pow(2, variables.length);
            const table = [];
            
            for (let i = 0; i < rows; i++) {
              const row = [];
              for (let j = 0; j < variables.length; j++) {
                row.push(i & Math.pow(2, j) ? true : false);
              }
              row.reverse();
              
              this.postOrder(this.expressionTree).forEach(element => {
                row.push(this.evaluateExpression(row, element));
              });

              table.push(row);
            }
            
            return table.reverse();
          },
          evaluateExpression(row, exp) {
            let vars = this.variables;
            
            for (let i = 0; i < vars.length; i++) {
              exp = exp.replace(new RegExp(vars[i], 'g'), row[i]);
            }
            
            return eval(exp);
          },
          shuntingYard(tokens) {
            const outputQueue = [];
            const operatorStack = [];
            const precedence = {
              "==": 0,
              "||": 1,
              "&&": 2,
              "!": 3,
            };
            const associativity = {
              "==": "left",
              "||": "left",
              "&&": "left",
              "!": "right",
            };
            
            tokens.forEach((token) => {
              if (/[a-zA-Z_]\w*/.test(token)) {
                // Si es una variable
                outputQueue.push(token);
              } else if (token === "!" || token === "&&" || token === "||" || token === "==") {
                // Si es un operador
                while (
                operatorStack.length > 0 &&
                operatorStack[operatorStack.length - 1] !== "(" &&
                ((associativity[token] === "left" &&
                precedence[token] <= precedence[operatorStack[operatorStack.length - 1]]) ||
                (associativity[token] === "right" &&
                precedence[token] < precedence[operatorStack[operatorStack.length - 1]]))
                ) {
                  outputQueue.push(operatorStack.pop());
                }
                operatorStack.push(token);
              } else if (token === "(") {
                operatorStack.push(token);
              } else if (token === ")") {
                while (operatorStack.length > 0 && operatorStack[operatorStack.length - 1] !== "(") {
                  outputQueue.push(operatorStack.pop());
                }
                operatorStack.pop(); // Quitar el paréntesis izquierdo
              }
            });
            
            while (operatorStack.length > 0) {
              outputQueue.push(operatorStack.pop());
            }
            
            return outputQueue;
          },
          buildExpressionTree(rpnTokens) {
            const stack = [];
            
            rpnTokens.forEach((token) => {
              if (/[a-zA-Z_]\w*/.test(token)) {
                // Si es una variable
                stack.push(new TreeNode(token));
              } else if (token === "!" || token === "&&" || token === "||" || token === "==") {
                if (token === "!") {
                  // Operador unario
                  const operand = stack.pop();
                  node = new TreeNode(token);
                  node.right = operand;
                  stack.push(node);
                } else {
                  // Operador binario
                  const right = stack.pop();
                  const left = stack.pop();
                  node = new TreeNode(token);
                  node.left = left;
                  node.right = right;
                  stack.push(node);
                }
              }
            });
            
            return stack[0];
          },
          postOrder(node) {
            const ret = [];
            if (node) {
              if (node.left) {
                ret.push(this.postOrder(node.left));
              }
              if (node.right) {
                ret.push(this.postOrder(node.right));
              }
              if (node.left || node.right) {
                ret.push(node.print());
              }
            }
            return ret.flat(Infinity);
          },
          generateHeaders() {
            const headers = [];
            this.variables.forEach((variable) => {
              headers.push(variable);
            });
            this.postOrder(this.expressionTree).forEach((element) => {
              headers.push(element);
            });

            for (let i = this.variables.length; i < headers.length; i++) {
              
              for (let j = this.postOrderExpressions.length - 1; j >= 0; j--) {
                if (headers[i].replace(this.postOrderExpressions[j], String.fromCharCode(65 + j + this.variables.length)).length > 1)
                  headers[i] = headers[i].replace(this.postOrderExpressions[j], String.fromCharCode(65 + j + this.variables.length));
              }
              
              for (let j = 0; j < this.variables.length; j++) {
                headers[i] = headers[i].replace(this.variables[j], String.fromCharCode(65 + j));
              }
              
            }

            return headers;
          }
        },
        mounted() {
          this.processExpression();
        }
      });
    </script>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-analytics.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyA6XyU7SEIVOqjgXtv05IqHGTkjcUAySKg",
        authDomain: "truth-d613c.firebaseapp.com",
        projectId: "truth-d613c",
        storageBucket: "truth-d613c.appspot.com",
        messagingSenderId: "513251055472",
        appId: "1:513251055472:web:c9f1f207049876e8a461b5",
        measurementId: "G-4NP4G0JB7P"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
    </script>
    
  </body>
  </html>